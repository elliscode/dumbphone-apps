<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Connections</title>
    <link rel="stylesheet" href="../css/stylesheet.css?v=024" />
    <link rel="stylesheet" href="../css/loader.css?v=024" />
    <link rel="icon" type="image/png" href="../img/connections.favicon.png?v=024" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:ital,wght@0,100..900;1,100..900&family=Moul&display=swap" rel="stylesheet">
    <style>
    </style>
  </head>
  <body>
    <button onclick="backupToServer(event)">Back Up Local Storage To Server</button>
    <div id="results">
    </div>
    <script src="../js/utils.js?v=024"></script>
    <script src="../js/env.js"></script>
    <script>
function getLocalStorage() {
  try {
    let connectionsDataString = localStorage.getItem("dumbphoneapps-connections-data");
    let connectionsData = JSON.parse(connectionsDataString);
    for (let dateValue of Object.keys(connectionsData)) {
      for (let i = 0; i < connectionsData[dateValue].length; i++) {
        if (typeof connectionsData[dateValue][i] == 'string') {
          connectionsData[dateValue][i] = JSON.parse(connectionsData[dateValue][i]);
        }
      }
    }
    if (connectionsData) {
      return connectionsData;
    }
  } catch (e) {
    // noop
  }
  return {};
}
function backupToServer(event) {
    let connectionsData = getLocalStorage(); 
    for (let dateValue of Object.keys(connectionsData)) {
        let guesses = connectionsData[dateValue];
        let url = API_DOMAIN + "/connections/set-guesses";
        let xmlHttp = new XMLHttpRequest();
        xmlHttp.open("POST", url, false); // false for synchronous request
        xmlHttp.withCredentials = true;
        xmlHttp.send(JSON.stringify({ csrf: csrfToken, date: dateValue, guesses: guesses }));
    }
}
    </script>
  </body>
</html>
